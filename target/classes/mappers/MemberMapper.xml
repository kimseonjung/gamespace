<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.semi.gamespace.member.model.dao.MemberMapper">
    <resultMap id="memberResultMap" type="com.semi.gamespace.member.model.dto.MemberDTO">
        <id property="memberCode" column="MEMBER_CODE"/>
        <result property="userId" column="MEMBER_ID"/>
        <result property="userPwd" column="MEMBER_PWD"/>
        <result property="userNickname" column="MEMBER_NICKNAME"/>
        <result property="userName" column="MEMBER_NAME"/>
        <result property="userPhone" column="MEMBER_PHONE"/>
        <result property="userEmail" column="MEMBER_EMAIL"/>
        <result property="userBirthday" column="MEMBER_BIRTH"/>
        <result property="userGender" column="MEMBER_GENDER"/>
        <result property="userAddress" column="ADDRESS"/>
        <result property="userIntroduce" column="INTRODUCE"/>
        <result property="userSiteLink1" column="SITE_LINK_1"/>
        <result property="userSiteLink2" column="SITE_LINK_2"/>
        <result property="userSiteLink3" column="SITE_LINK_3"/>
        <result property="userSiteLink4" column="SITE_LINK_4"/>
        <result property="userSiteLink5" column="SITE_LINK_5"/>
        <result property="userSiteLink6" column="SITE_LINK_6"/>
        <result property="enrollDate" column="ENROLL_DATE"/>
        <result property="memberStatus" column="MEMBER_STATUS"/>
        <result property="banDate" column="BAN_DATE"/>
        <result property="isAdmin" column="ADMIN_YN"/>
    </resultMap>

    <select id="findMemberById" resultMap="memberResultMap" parameterType="string">
        SELECT M.MEMBER_CODE,
               M.MEMBER_ID,
               M.MEMBER_PWD,
               M.MEMBER_NICKNAME,
               M.MEMBER_NAME,
               M.MEMBER_PHONE,
               M.MEMBER_EMAIL,
               M.MEMBER_BIRTH,
               M.MEMBER_GENDER,
               M.ADDRESS,
               M.INTRODUCE,
               M.SITE_LINK_1,
               M.SITE_LINK_2,
               M.SITE_LINK_3,
               M.SITE_LINK_4,
               M.SITE_LINK_5,
               M.SITE_LINK_6,
               M.ENROLL_DATE,
               M.MEMBER_STATUS,
               M.BAN_DATE,
               M.ADMIN_YN
        FROM MEMBER M
        WHERE M.MEMBER_ID = #{ userId }
    </select>

    <select id="findMemberByEmailForSocialLogin" resultMap="memberResultMap" parameterType="string">
        SELECT M.MEMBER_CODE,
               M.MEMBER_ID,
               M.MEMBER_PWD,
               M.MEMBER_NICKNAME,
               M.MEMBER_NAME,
               M.MEMBER_PHONE,
               M.MEMBER_EMAIL,
               M.MEMBER_BIRTH,
               M.MEMBER_GENDER,
               M.ADDRESS,
               M.INTRODUCE,
               M.SITE_LINK_1,
               M.SITE_LINK_2,
               M.SITE_LINK_3,
               M.SITE_LINK_4,
               M.SITE_LINK_5,
               M.SITE_LINK_6,
               M.ENROLL_DATE,
               M.MEMBER_STATUS,
               M.BAN_DATE,
               M.ADMIN_YN
        FROM MEMBER M
        WHERE M.MEMBER_EMAIL = #{ userEmail }
    </select>

    <select id="selectAllMember" resultMap="memberResultMap">
        SELECT M.MEMBER_CODE,
               M.MEMBER_ID,
               M.MEMBER_PWD,
               M.MEMBER_NICKNAME,
               M.MEMBER_NAME,
               M.MEMBER_PHONE,
               M.MEMBER_EMAIL,
               M.MEMBER_BIRTH,
               M.MEMBER_GENDER,
               M.ADDRESS,
               M.INTRODUCE,
               M.SITE_LINK_1,
               M.SITE_LINK_2,
               M.SITE_LINK_3,
               M.SITE_LINK_4,
               M.SITE_LINK_5,
               M.SITE_LINK_6,
               M.ENROLL_DATE,
               M.MEMBER_STATUS,
               M.BAN_DATE,
               M.ADMIN_YN
        FROM MEMBER M
        ORDER BY M.MEMBER_CODE
    </select>

    <select id="countFollowFromByCode" resultType="_int" parameterType="string">
        SELECT COUNT(*)
          FROM FOLLOW F
         WHERE F.FOLLOW_TAR_CODE = #{ code }
    </select>

    <select id="countFollowToByCode" resultType="_int" parameterType="string">
        SELECT COUNT(*)
          FROM FOLLOW F
         WHERE F.FOLLOW_REQ_CODE = #{ code }
    </select>

    <select id="countHistoryOfBoard" resultType="_int" parameterType="string">
        SELECT
            (SELECT COUNT(*) FROM FREE_GAL WHERE MEMBER_CODE = #{ code }),
            (SELECT COUNT(*) FROM GAME_GAL WHERE MEMBER_CODE = #{ code })
        FROM DUAL
    </select>

    <select id="countHistoryOfComment" resultType="_int" parameterType="string">
        SELECT
                (SELECT COUNT(*) FROM FREE_GAL_COM WHERE MEMBER_CODE = #{ code }),
                (SELECT COUNT(*) FROM GAME_GAL_COM WHERE MEMBER_CODE = #{ code })
        FROM DUAL
    </select>

    <select id="SocialMemberEmailCheck" resultType="_int" parameterType="string">
        SELECT COUNT(*)
        FROM MEMBER M
        WHERE M.MEMBER_EMAIL = #{ userEmail }
    </select>

    <insert id="registMember" parameterType="com.semi.gamespace.member.model.dto.MemberDTO">
        INSERT
        INTO MEMBER M (
               M.MEMBER_CODE,
               M.MEMBER_ID,
               M.MEMBER_PWD,
               M.MEMBER_NICKNAME,
               M.MEMBER_NAME,
               M.MEMBER_PHONE,
               M.MEMBER_EMAIL,
               M.MEMBER_BIRTH,
               M.MEMBER_GENDER,
               M.ADDRESS,
               M.INTRODUCE,
               M.SITE_LINK_1,
               M.SITE_LINK_2,
               M.SITE_LINK_3,
               M.SITE_LINK_4,
               M.SITE_LINK_5,
               M.SITE_LINK_6,
               M.ENROLL_DATE,
               M.MEMBER_STATUS,
               M.BAN_DATE,
               M.ADMIN_YN
        )
        VALUES (
            'MEM_'||MEMBER_CODE_SEQ.NEXTVAL,
            #{ userId },
            #{ userPwd },
            #{ userNickname },
            #{ userName },
            #{ userPhone },
            #{ userEmail },
            TO_DATE(#{ userBirthday }, 'YYYY-MM-DD'),
            #{ userGender },
            #{ userAddress },
            #{ userIntroduce },
            NULL,
            NULL,
            NULL,
            NULL,
            NULL,
            NULL,
            TO_DATE(SYSDATE, 'YYYY-MM-DD'),
            'Y',
            NULL,
            'N'
        )
    </insert>

    <update id="updateMember" parameterType="com.semi.gamespace.member.model.dto.MemberDTO">
        UPDATE MEMBER M
           SET (
               M.MEMBER_NICKNAME,
               M.MEMBER_NAME,
               M.MEMBER_PHONE,
               M.MEMBER_EMAIL,
               M.MEMBER_BIRTH,
               M.MEMBER_GENDER,
               M.ADDRESS,
               M.INTRODUCE
            ) = ( SELECT #{ userNickname },
                         #{ userName },
                         #{ userPhone },
                         #{ userEmail },
                         TO_DATE(#{ userBirthday }, 'YYYY-MM-DD'),
                         #{ userGender },
                         #{ userAddress },
                         #{ userIntroduce }
                    FROM DUAL
            )
         WHERE M.MEMBER_ID = #{ userId }
    </update>

    <update id="updateMemberSiteLink" parameterType="java.util.HashMap">
        UPDATE MEMBER M
        <set>
        <choose>
            <when test="linkCode == 1">M.SITE_LINK_1 = #{ modifyLink }</when>
            <when test="linkCode == 2">M.SITE_LINK_2 = #{ modifyLink }</when>
            <when test="linkCode == 3">M.SITE_LINK_3 = #{ modifyLink }</when>
            <when test="linkCode == 4">M.SITE_LINK_4 = #{ modifyLink }</when>
            <when test="linkCode == 5">M.SITE_LINK_5 = #{ modifyLink }</when>
            <when test="linkCode == 6">M.SITE_LINK_6 = #{ modifyLink }</when>
        </choose>
        </set>
        WHERE M.MEMBER_CODE = #{ memberCode }
    </update>
</mapper>