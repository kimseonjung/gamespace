<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="setContent(content)">
<head>
    <meta charset="UTF-8">

    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/game/gameMain.css">

    <title>gamespace</title>

    <!-- jQuery library -->
    <!--    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>-->

    <!-- Popper JS-->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

</head>
<body>

<div id="game">
    <th:block th:replace="~{common/header :: header}"/>
</div>



<!--th:text="${category.categoryName}"-->
<!--th:field="*{category}"-->
<!--th:for="${#ids.prev(categoryList)}"-->
<!--th:value="${category.categoryCode}"-->
    <section class="gametag-wrap">
        <div class="gametag-header">
            <div class="logo"><img src="/image/icon_light/gamespace.svg" alt="gamespace"></div>
        </div>

<!--                <form action="/game/game"  method="post" onsubmit="return false;" id="category" class="gamecategorytag">-->
<!--        style="position: absolute;left: -1000%;"-->
                    <div class="gametag-body">
                        <div class="gametag-body-left">Category</div>
                        <table th:each="category : ${categoryList}" id="categoryCode" class="gametags">
                            <tr>
                                <td><label th:for="${category.categoryCode}" th:text="${category.categoryName}"></label><input th:id="${category.categoryCode}" th:value="${category.categoryCode}" th:type="checkbox" name="categoryCode" class="categoryCheck" onclick="searchGameMainList()" ></td>
                            </tr>
                        </table>
                    </div>

                    <div class="gametag-body">
                        <div class="gametag-body-left">Tag</div>
                        <table th:each="tag : ${tagList}" id="tagCode" class="gametags">
                            <tr>
                                <td><label th:for="${tag.tagCode}" th:text="${tag.tagName}"></label><input th:id="${tag.tagCode}" th:value="${tag.tagCode}" th:type="checkbox" name="tagCode" class="tagCheck" onclick="searchGameMainList()"></td>
                            </tr>
                        </table>
                    </div>


<!--                    <div th:each="devices : ${devicesList}">-->
<!--                        <button th:text="${devices.devicesName}"></button>-->
<!--                    </div>-->


<!--                </form>-->
        <div class="gametag-foot">
            <div class="tag" id="tag-result"></div>
        </div>

    </section>


    <section>



        <div th:id="search" class="lists">
                    <div class='list' th:each="game : ${gameInfoList}"> <!--th:class="t-body"-->
                        <div class='game-head' th:text="${game.gameName}"></div>
                        <div th:text="${game.categoryCode}"></div>
                        <div th:text="${game.tagCode}"></div>
                        <div class='news-body' th:text="${game.gameIntro}"></div>
                    </div>

        </div>



    </section>





<div class="pagination">
    <div class="pagination-wrap">
        <i class="left-icon"><img src="/image/svg/icon-arrow-left.svg" alt="left"></i>
        <ol id="numbers"></ol>
        <i class="right-icon"><img src="/image/svg/icon-arrow-right.svg" alt="right"></i>
    </div>
</div>
<script src="/js/pagination.js"></script>



<div class="footer">
    <th:block th:replace="~{common/footer :: footer}"/>
</div>

<script>

   function searchGameMainList() {

       const categoryCode = [];
       categoryCode.push('tmp');
       $("input[name='categoryCode']:checked").each(function (){
           let chk = $(this).val();
           categoryCode.push(chk);
       });

       const tagCode = [];
       tagCode.push('tmp');
       $("input[name='tagCode']:checked").each(function (){
           let thk = $(this).val();
           tagCode.push(thk);
       });


       console.log(categoryCode);
       console.log(tagCode);

       $.ajax({
           url: "/game/game",             // 요청할 서버url
           type : "post", // 타입은 뭘 쓸거니?
           datatype : "json",
           data: {
               categoryCode : categoryCode,
               tagCode : tagCode
           },

           success: function(data,status, xhr) {    // 결과 성공 콜백함수

               console.log(data.categoryTagList[0].gameName);


               $('#search').html("");

               data.categoryTagList.forEach(function(item) {
                   let table = "<div class='list'>";
                   table += "<div class='game-head'>"+item.gameName+"</div>";
                   table += "<div class=''>"+item.categoryCode+"</div>";
                   table += "<div class=''>"+item.tagCode+"</div>";
                   table += "<div class='news-body'>"+item.gameIntro+"</div>";
                   table += "</div>";
                   $('#search').append(table);
               });


           },
           error: function(xhr, status, error) {   // 결과 에러 콜백함수
               console.log('error');
           }
       });
   };






</script>

</body>
</th:block>
</html>